(()=>{const e="../../backEnd/php/";function t(){fetch(e+"getPagosPendientes.php",{method:"POST",headers:{"Content-Type":"application/json"}}).then((e=>e.json())).then((t=>{const n=document.getElementById("contenedor-pendientes");if(n.innerHTML="","No hay datos"===t)document.getElementById("titulo").innerText="No hay datos todavía!";else{const o=t.reduce(((e,t)=>(e[t.nombre]||(e[t.nombre]={nombre:t.nombre,pagos:[],total:0}),e[t.nombre].pagos.push({monto:t.monto,fecha:t.fecha,horas:t.horas,id:t.id}),e[t.nombre].total+=parseFloat(t.monto),e)),{});Object.values(o).forEach((e=>{const t=`\n            <div class="col-md-4 mb-4">\n              <div class="card h-100" style="background-color: rgba(0, 0, 0, 0.2);">\n                <div class="card-body d-flex flex-column">\n                  <h5 class="card-title">${e.nombre}</h5>\n                  ${e.pagos.map((e=>`\n                    <p class="card-text">${e.monto}€ - ${e.fecha}</p>\n                  `)).join("")}\n                  <p class="card-text mt-auto"><strong>Total pendiente: ${e.total.toFixed(2)}€</strong></p>\n                  <div class="mt-2">\n                    <button class='btn btn-success pagarBtn' data-id='${e.pagos[0].id}'>Pagar Último</button>\n                    <button class="btn btn-danger eliminar" data-id="${e.pagos[0].id}" data-tipo="pendiente">Eliminar</button>\n                  </div>\n                </div>\n              </div>\n            </div>\n          `;n.insertAdjacentHTML("beforeend",t)})),document.querySelectorAll(".pagarBtn").forEach((t=>{t.addEventListener("click",(function(){var t;t=this.getAttribute("data-id"),fetch(e+"pagar.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:t})}).then((e=>e.json())).then((e=>{"Exito"===e?(alert("Pago registrado!"),location.reload()):alert("Error al registrar el pago!"+e)})).catch((e=>{console.error("Error del servidor:",e)}))}))}))}})).catch((e=>{console.error("Error:",e)}))}document.addEventListener("DOMContentLoaded",(function(){t(),fetch(e+"getStudents_back.php").then((e=>e.json())).then((e=>{if(e.success){const t=document.getElementById("alumnoSelect");e.alumnos.forEach((e=>{const n=document.createElement("option");n.value=e.id,n.textContent=e.nombre,t.appendChild(n)}))}})).catch((e=>console.error("Error:",e))),document.getElementById("formAgregarPendiente").addEventListener("submit",(function(t){t.preventDefault();var n=new FormData(this);fetch(e+"setPagoP.php",{method:"POST",body:n}).then((e=>e.json())).then((e=>{"Exito"===e&&(location.href="ingresos_pendientes.html")})).catch((e=>{console.error("Ha habido un error"+e)}))})),fetch(e+"getTotalP.php",{method:"POST",headers:{"Content-Type":"application/json"}}).then((e=>e.json())).then((e=>{console.log(e);const t=`\n      <div class="card-body"> \n        <h5 class="">Total Pendiente: ${e}€</h5>\n      </div>\n    `;document.getElementById("totalP").insertAdjacentHTML("beforeend",t)}))}))})();