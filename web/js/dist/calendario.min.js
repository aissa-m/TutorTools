const URL="../../backEnd/php/";document.addEventListener("DOMContentLoaded",function(){var calendarEl=document.getElementById("calendar");var calendar=new FullCalendar.Calendar(calendarEl,{locale:"es",firstDay:1,initialView:"dayGridMonth",headerToolbar:false,events:URL+"cargar_eventos.php",height:"auto",datesSet:function(dateInfo){document.getElementById("currentMonthYear").innerHTML=`<h4>${dateInfo.view.title}</h4>`},eventContent:function(arg){var timeElement=document.createElement("div");timeElement.classList.add("fc-event-time");var startTime=new Date(arg.event.start).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});var endTime=new Date(arg.event.end).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});timeElement.innerHTML=startTime+" - "+endTime;timeElement.style.color="black";var titleElement=document.createElement("div");titleElement.classList.add("fc-event-title");titleElement.innerHTML=arg.event.title;titleElement.style.color=arg.textColor;var containerElement=document.createElement("div");containerElement.appendChild(timeElement);containerElement.appendChild(titleElement);return{domNodes:[containerElement]}},slotDuration:"01:00:00",eventClick:function(info){var event=info.event;document.getElementById("eventId").value=event.id;document.getElementById("editTitulo").value=event.title;document.getElementById("editDescription").value=event.extendedProps.description;document.getElementById("editStart").value=event.start.toISOString().slice(0,16);document.getElementById("editEnd").value=event.end.toISOString().slice(0,16);document.getElementById("editColor").value=event.backgroundColor;document.getElementById("editTextColor").value=event.textColor;$("#editEventModal").modal("show")}});calendar.render();document.getElementById("btnPrev").addEventListener("click",function(){calendar.prev()});document.getElementById("btnToday").addEventListener("click",function(){calendar.today()});document.getElementById("btnNext").addEventListener("click",function(){calendar.next()});function closeSidebarMenu(){var sidebarMenu=document.getElementById("sidebarMenu");if(sidebarMenu.classList.contains("open")){sidebarMenu.classList.remove("open")}}document.getElementById("btnMonth").addEventListener("click",function(){calendar.changeView("dayGridMonth");closeSidebarMenu()});document.getElementById("btnMonth2").addEventListener("click",function(){calendar.changeView("dayGridMonth");closeSidebarMenu()});document.getElementById("btnWeek").addEventListener("click",function(){calendar.changeView("timeGridWeek");closeSidebarMenu()});document.getElementById("btnWeek2").addEventListener("click",function(){calendar.changeView("timeGridWeek");closeSidebarMenu()});document.getElementById("btnDay").addEventListener("click",function(){calendar.changeView("timeGridDay");closeSidebarMenu()});document.getElementById("btnDay2").addEventListener("click",function(){calendar.changeView("timeGridDay");closeSidebarMenu()});document.getElementById("toggleMenu").addEventListener("click",function(){document.getElementById("sidebarMenu").classList.toggle("open")});document.getElementById("addEventBtn").addEventListener("click",function(){$("#eventModal").modal("show")});document.getElementById("createEventForm").addEventListener("submit",function(e){e.preventDefault();const tituloEvento=document.getElementById("eventTitle");const descripcionEvento=document.getElementById("eventDescription");if(!/^[a-zA-Z0-9\sáéíóúÁÉÍÓÚñÑ.,;:!¿?¡()'-]*$/.test(tituloEvento.value)){tituloEvento.classList.add("is-invalid");alert("El título del evento contiene caracteres no permitidos.");e.preventDefault();return false}if(!/^[a-zA-Z0-9\sáéíóúÁÉÍÓÚñÑ.,;:!¿?¡()'-]*$/.test(descripcionEvento.value)){descripcionEvento.classList.add("is-invalid");alert("La descripción del evento contiene caracteres no permitidos.");e.preventDefault();return false}const title=document.getElementById("eventTitle").value;const description=document.getElementById("eventDescription").value;const start=document.getElementById("eventStart").value;const end=document.getElementById("eventEnd").value;const color=document.getElementById("eventColor").value;const textColor=document.getElementById("eventTextColor").value;const id=localStorage.getItem("id");const formData=new FormData;formData.append("titulo",title);formData.append("descripcion",description);formData.append("inicio",start);formData.append("fin",end);formData.append("color",color);formData.append("textColor",textColor);formData.append("idProfe",id);fetch(URL+"crear_evento.php",{method:"POST",body:formData}).then(response=>response.json()).then(data=>{if(data.success){$("#eventModal").modal("hide");calendar.refetchEvents()}else{throw new Error(data.message)}}).catch(error=>{console.error("Error:",error);alert("Error al crear el evento: "+error.message)})});document.getElementById("editEventForm").addEventListener("submit",function(e){e.preventDefault();const id=document.getElementById("eventId").value;const title=document.getElementById("editTitulo").value;const description=document.getElementById("editDescription").value;const start=document.getElementById("editStart").value;const end=document.getElementById("editEnd").value;const color=document.getElementById("editColor").value;const textColor=document.getElementById("editTextColor").value;const formData=new FormData;formData.append("id",id);formData.append("titulo",title);formData.append("descripcion",description);formData.append("inicio",start);formData.append("fin",end);formData.append("color",color);formData.append("textColor",textColor);fetch(URL+"actualizar_evento.php",{method:"POST",body:formData}).then(response=>response.json()).then(data=>{if(data.success){$("#editEventModal").modal("hide");calendar.refetchEvents()}else{throw new Error(data.message||"Error al actualizar el evento")}}).catch(error=>{console.error("Error al actualizar el evento:",error);alert("Error al actualizar el evento: "+error.message)})});document.getElementById("deleteEventButton").addEventListener("click",function(){const eventId=document.getElementById("eventId").value;if(confirm("¿Estás seguro de que deseas eliminar este evento?")){fetch(URL+"eliminar_evento.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`id=${eventId}`}).then(response=>response.json()).then(data=>{if(data.success){$("#editEventModal").modal("hide");calendar.refetchEvents()}else{throw new Error(data.message||"Error al eliminar el evento")}}).catch(error=>{console.error("Error al eliminar el evento:",error);alert("Error al eliminar el evento: "+error.message)})}})});